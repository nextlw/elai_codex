# ü¶Ä Dockerfile para Codex-RS TUI (Rust Nativo)\n\n## üìã **DOCKERFILE COMPLETO PARA TUI**\n\nCrie um arquivo chamado `Dockerfile.tui` no diret√≥rio `codex-rs/`:\n\n```dockerfile\n# ================================\n# Dockerfile para Codex-RS TUI (Rust Nativo)\n# ================================\n\n# =====================================\n# Stage 1: Build Environment\n# =====================================\nFROM rust:1.75-bookworm as builder\n\n# Instalar depend√™ncias de sistema necess√°rias para build\nRUN apt-get update && apt-get install -y \\\n    pkg-config \\\n    libssl-dev \\\n    ca-certificates \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Configurar diret√≥rio de trabalho\nWORKDIR /build\n\n# Copiar manifesto de depend√™ncias primeiro (para cache de layers)\nCOPY Cargo.toml Cargo.lock ./\nCOPY rust-toolchain.toml ./\nCOPY clippy.toml ./\n\n# Copiar todos os Cargo.toml dos workspace members\nCOPY ansi-escape/Cargo.toml ./ansi-escape/\nCOPY apply-patch/Cargo.toml ./apply-patch/\nCOPY arg0/Cargo.toml ./arg0/\nCOPY cli/Cargo.toml ./cli/\nCOPY common/Cargo.toml ./common/\nCOPY core/Cargo.toml ./core/\nCOPY exec/Cargo.toml ./exec/\nCOPY execpolicy/Cargo.toml ./execpolicy/\nCOPY file-search/Cargo.toml ./file-search/\nCOPY linux-sandbox/Cargo.toml ./linux-sandbox/\nCOPY login/Cargo.toml ./login/\nCOPY mcp-client/Cargo.toml ./mcp-client/\nCOPY mcp-server/Cargo.toml ./mcp-server/\nCOPY mcp-types/Cargo.toml ./mcp-types/\nCOPY ollama/Cargo.toml ./ollama/\nCOPY protocol/Cargo.toml ./protocol/\nCOPY protocol-ts/Cargo.toml ./protocol-ts/\nCOPY tui/Cargo.toml ./tui/\n\n# Criar estrutura de diret√≥rios vazios para deps\nRUN mkdir -p \\\n    ansi-escape/src \\\n    apply-patch/src \\\n    arg0/src \\\n    cli/src \\\n    common/src \\\n    core/src \\\n    exec/src \\\n    execpolicy/src \\\n    file-search/src \\\n    linux-sandbox/src \\\n    login/src \\\n    mcp-client/src \\\n    mcp-server/src \\\n    mcp-types/src \\\n    ollama/src \\\n    protocol/src \\\n    protocol-ts/src \\\n    tui/src\n\n# Criar arquivos lib.rs/main.rs vazios para satisfazer cargo\nRUN echo 'fn main() {}' > cli/src/main.rs && \\\n    echo 'fn main() {}' > exec/src/main.rs && \\\n    echo 'fn main() {}' > tui/src/main.rs && \\\n    find . -name \"src\" -type d -exec touch {}/lib.rs \\;\n\n# Build inicial das depend√™ncias (cache layer)\nRUN cargo build --release --workspace\nRUN rm -rf */src\n\n# Copiar c√≥digo fonte real\nCOPY . .\n\n# Build final otimizado com todas as features\nENV CARGO_TERM_COLOR=never\nRUN cargo build --release --bin codex \\\n    && strip target/release/codex\n\n# =====================================\n# Stage 2: Runtime Environment\n# =====================================\nFROM debian:bookworm-slim as runtime\n\n# Instalar depend√™ncias runtime m√≠nimas\nRUN apt-get update && apt-get install -y \\\n    ca-certificates \\\n    git \\\n    curl \\\n    less \\\n    ripgrep \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Criar usu√°rio n√£o-root\nRUN groupadd -r codex && useradd -r -g codex codex\n\n# Criar diret√≥rios necess√°rios\nRUN mkdir -p /app /home/codex/.codex /logs && \\\n    chown -R codex:codex /app /home/codex /logs\n\n# Copiar bin√°rio otimizado\nCOPY --from=builder /build/target/release/codex /usr/local/bin/codex\n\n# Copiar arquivos de configura√ß√£o se existirem\nCOPY --from=builder /build/core/src/seatbelt_base_policy.sbpl /usr/local/share/codex/ || true\nCOPY --from=builder /build/execpolicy/src/default.policy /usr/local/share/codex/ || true\n\n# Definir usu√°rio\nUSER codex\nWORKDIR /app\n\n# Vari√°veis de ambiente otimizadas para container\nENV RUST_LOG=codex_core=info,codex_tui=info\nENV RUST_BACKTRACE=1\nENV CODEX_CONFIG_PATH=/home/codex/.codex/config.toml\nENV CODEX_CACHE_DIR=/home/codex/.codex/cache\nENV CODEX_LOG_DIR=/logs\n\n# Labels para metadados\nLABEL org.opencontainers.image.title=\"Codex TUI (Rust Native)\"\nLABEL org.opencontainers.image.description=\"Codex AI Assistant with native Rust TUI interface\"\nLABEL org.opencontainers.image.version=\"latest\"\nLABEL org.opencontainers.image.source=\"https://github.com/openai/codex\"\n\n# Health check\nHEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \\\n    CMD codex --version || exit 1\n\n# Entrypoint configur√°vel\nENTRYPOINT [\"codex\"]\nCMD [\"--help\"]\n\n# =====================================\n# Stage 3: Development Environment (opcional)\n# =====================================\nFROM runtime as dev\n\nUSER root\n\n# Instalar ferramentas de desenvolvimento\nRUN apt-get update && apt-get install -y \\\n    vim \\\n    tmux \\\n    htop \\\n    strace \\\n    gdb \\\n    valgrind \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Voltar para usu√°rio codex\nUSER codex\n\n# Configura√ß√£o para desenvolvimento\nENV RUST_LOG=debug\nENV RUST_BACKTRACE=full\n\nCMD [\"bash\"]\n```\n\n## üî® **COMANDOS PARA BUILD**\n\n### **1. Build da Imagem Principal**\n```bash\n# No diret√≥rio codex-rs/\ndocker build -f Dockerfile.tui -t codex-tui:latest .\n```\n\n### **2. Build da Imagem de Desenvolvimento**\n```bash\n# Vers√£o com ferramentas de debug\ndocker build -f Dockerfile.tui --target dev -t codex-tui:dev .\n```\n\n### **3. Build Otimizado para Produ√ß√£o**\n```bash\n# Build com otimiza√ß√µes m√°ximas\ndocker build -f Dockerfile.tui \\\n  --build-arg RUSTFLAGS=\"-C target-cpu=native\" \\\n  -t codex-tui:optimized .\n```\n\n## üöÄ **COMO USAR O CONTAINER TUI**\n\n### **Uso Interativo (TUI Completo)**\n```bash\n# Executar TUI interativo\ndocker run -it --rm \\\n  -v $(pwd):/app \\\n  -e OPENAI_API_KEY=\"sua-chave\" \\\n  codex-tui:latest\n\n# Com configura√ß√£o persistente\ndocker run -it --rm \\\n  -v $(pwd):/app \\\n  -v ~/.codex:/home/codex/.codex \\\n  -e OPENAI_API_KEY=\"sua-chave\" \\\n  codex-tui:latest\n```\n\n### **Uso N√£o-Interativo (Exec Mode)**\n```bash\n# Modo exec mesmo no container TUI\ndocker run --rm \\\n  -v $(pwd):/app \\\n  -e OPENAI_API_KEY=\"sua-chave\" \\\n  codex-tui:latest \\\n  exec --full-auto \"sua tarefa\"\n```\n\n### **Modo de Desenvolvimento**\n```bash\n# Container de desenvolvimento com ferramentas\ndocker run -it --rm \\\n  -v $(pwd):/app \\\n  -v ~/.codex:/home/codex/.codex \\\n  codex-tui:dev \\\n  bash\n```\n\n## üìä **COMPARA√á√ÉO: CLI vs TUI**\n\n| Caracter√≠stica | CLI Container (Node) | TUI Container (Rust) |\n|----------------|---------------------|---------------------|\n| **Tamanho** | ~500MB | ~150MB |\n| **Startup** | 3-5s | <1s |\n| **RAM** | 256MB | 128MB |\n| **CPU** | 0.25 cores | 0.1 cores |\n| **Modos** | `exec`, `apply`, `login` | **TODOS** os modos |\n| **TUI** | ‚ùå N√£o | ‚úÖ **SIM** |\n| **Exec** | ‚úÖ Sim | ‚úÖ Sim |\n| **Interativo** | ‚ùå Limitado | ‚úÖ **Completo** |\n\n## ‚ö° **VANTAGENS DO CONTAINER TUI**\n\n### **‚úÖ Funcionalidades Completas**\n- **TUI Interativo** - Interface completa com chat visual\n- **File Search** - Navega√ß√£o por arquivos (`@` trigger)\n- **Backtrack** - Edi√ß√£o de mensagens anteriores (Esc-Esc)\n- **Apply Patches** - Visualiza√ß√£o e aplica√ß√£o de diffs\n- **MCP Support** - Model Context Protocol completo\n\n### **‚úÖ Performance Otimizada**\n- **Rust Nativo** - Performance m√°xima\n- **Multi-stage Build** - Imagem final limpa\n- **Stripped Binary** - Menor tamanho\n- **Cache Layers** - Build r√°pido com cache\n\n### **‚úÖ Flexibilidade Total**\n- **Dual Mode** - TUI interativo OU exec n√£o-interativo\n- **Development Stage** - Vers√£o com ferramentas de debug\n- **Configur√°vel** - Todos os argumentos de linha de comando\n\n## üîß **INTEGRA√á√ÉO COM AZURE PIPELINE**\n\n### **Pipeline H√≠brido (CLI + TUI)**\n```yaml\n# azure-pipelines-hybrid.yml\nparameters:\n  - name: useInteractiveMode\n    displayName: 'Usar modo interativo (TUI)?'\n    type: boolean\n    default: false\n\nvariables:\n  - name: containerImage\n    value: ${